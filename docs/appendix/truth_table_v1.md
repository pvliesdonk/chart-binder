# 1) Edition-Pattern → Tag Truth Table (v1)

Each row says: what we look for (conceptual regex), a few canonical examples, what tag(s) we emit, whether we strip the matched fragment from the **title core**, and special notes. Patterns are case/locale-insensitive; brackets mean any of () [] {}.

| Category           | Detection pattern (conceptual)                                                 | Examples (non-exhaustive)                              | Emitted tag(s)                                            | Strip from core?                                                 | Notes                                                       |                                                         |                                    |         |                                |                                                   |                                          |
| ------------------ | ------------------------------------------------------------------------------ | ------------------------------------------------------ | --------------------------------------------------------- | ---------------------------------------------------------------- | ----------------------------------------------------------- | ------------------------------------------------------- | ---------------------------------- | ------- | ------------------------------ | ------------------------------------------------- | ---------------------------------------- |
| Radio edit         | `[([-]\s*(radio                                                                | single                                                 | 7("                                                       | in)?)[ -]?edit\s*[)]]?$`                                         | `Song (Radio Edit)`, `Song - Single Edit`, `Song (7" Edit)` | `{"kind":"edit","sub":"radio"                           | "single"                           | "7in"}` | Yes                            | Prefer “radio” over ambiguous “edit” when present |                                          |
| Short/Album edit   | `[([-]\s*(edit                                                                 | album edit                                             | short version)\s*[)]]?$`                                  | `Song (Edit)`, `Song (Album Edit)`                               | `{"kind":"edit","sub":"edit"                                | "album"                                                 | "short"}`                          | Yes     | Treat “Edit” generic if no sub |                                                   |                                          |
| Extended/12"       | `[([-]\s*(extended( mix)?                                                      | 12("                                                   | in)? mix)\s*[)]]?$`                                       | `Song (Extended Mix)`, `Song - 12" Mix`                          | `{"kind":"edit","sub":"extended"                            | "12in"}`                                                | Yes                                |         |                                |                                                   |                                          |
| Club/Dub           | `[([-]\s*(club mix                                                             | club edit                                              | dub                                                       | dub mix)\s*[)]]?$`                                               | `Song (Club Mix)`, `Song (Dub)`                             | `{"kind":"mix","sub":"club"                             | "dub"}`                            | Yes     |                                |                                                   |                                          |
| Instrumental       | `[\(\[-]\s*instrumental\s*[\)\]]?$`                                            | `Song (Instrumental)`                                  | `{"kind":"mix","sub":"instrumental"}`                     | Yes                                                              |                                                             |                                                         |                                    |         |                                |                                                   |                                          |
| A cappella         | `[\(\[-]\s*a ?cap+pella\s*[\)\]]?$`                                            | `Song (A Cappella)`                                    | `{"kind":"mix","sub":"acapella"}`                         | Yes                                                              |                                                             |                                                         |                                    |         |                                |                                                   |                                          |
| Remix generic      | `[\(\[-]\s*remix\s*[\)\]]?$`                                                   | `Song (Remix)`                                         | `{"kind":"remix"}`                                        | Yes                                                              |                                                             |                                                         |                                    |         |                                |                                                   |                                          |
| Named remixer      | `[\(\[-]\s*([A-Za-z0-9 .&’'-]+)\s+remix\s*[\)\]]?$`                            | `Song (Armin van Buuren Remix)`, `Song (Avicii Remix)` | `{"kind":"remix","mixer":"<name>"}`                       | Yes                                                              | Keep normalized mixer name                                  |                                                         |                                    |         |                                |                                                   |                                          |
| Live generic       | `[\(\[-]\s*live\s*[\)\]]?$`                                                    | `Song (Live)`                                          | `{"kind":"live"}`                                         | Yes                                                              |                                                             |                                                         |                                    |         |                                |                                                   |                                          |
| Live w/ venue/date | `[([-]\s*live( at                                                              | from)?\s+([^)]]+)\s*[)]]?$`                            | `Song (Live at Reading 1992)`, `Song - Live from Brixton` | `{"kind":"live","place/date":"<text>"}`                          | Yes                                                         | Parse place/date when easy                              |                                    |         |                                |                                                   |                                          |
| Acoustic/Unplugged | `[([-]\s*(acoustic                                                             | unplugged                                              | piano version)\s*[)]]?$`                                  | `Song (Acoustic)`, `Song - Piano Version`                        | `{"kind":"acoustic"}`                                       | Yes                                                     |                                    |         |                                |                                                   |                                          |
| Mono/Stereo        | `[([-]\s*(mono                                                                 | stereo)\s*[)]]?$`                                      | `Song (Mono)`                                             | `{"kind":"mix","sub":"mono"                                      | "stereo"}`                                                  | Yes                                                     |                                    |         |                                |                                                   |                                          |
| Demo/Early         | `[([-]\s*(demo                                                                 | early version                                          | rough mix                                                 | work tape)\s*[)]]?$`                                             | `Song (Demo)`                                               | `{"kind":"demo"}`                                       | Yes                                |         |                                |                                                   |                                          |
| Clean/Explicit     | `[([-]\s*(clean                                                                | explicit)\s*[)]]?$`                                    | `Song (Explicit)`                                         | `{"kind":"content","sub":"clean"                                 | "explicit"}`                                                | Yes                                                     |                                    |         |                                |                                                   |                                          |
| Re-recording       | `[([-]\s*(re-?record(ed)?                                                      | new recording                                          | taylor’s version)\s*[)]]?$`                               | `Song (Re-Recorded)`, `Song (Taylor’s Version)`                  | `{"kind":"re_recording","note":"taylor’s version"?}`        | Yes                                                     | Do **not** conflate with remaster  |         |                                |                                                   |                                          |
| Year/era variant   | `['’]\d{2}$` or `\b(’                                                          | ')\d{2}\b`                                             | `Blue Monday ’88`                                         | `{"kind":"re_recording","note":"’88"}`                           | **No** (keep in core?) → **Yes** for matching; store tag    | Strip for **core**, keep original for display           |                                    |         |                                |                                                   |                                          |
| Remaster           | `[\(\[-]\s*remaster(ed)?(\s*\d{4})?\s*[\)\]]?$` or `-\s*remaster(ed)?\s*\d{4}` | `Song (Remastered 2011)`, `Song - Remastered`          | `{"kind":"remaster","year":"2011"?}`                      | Yes                                                              |                                                             |                                                         |                                    |         |                                |                                                   |                                          |
| OST suffix         | `[([-]\s*(from                                                                 | uit                                                    | van de film)\s+"([^"]+)"\s*[)]]?$`                        | `Song (From "Trainspotting")`, `Song (Uit "Soldaat van Oranje")` | `{"kind":"ost","work":"<title>"}`                           | Yes                                                     | Locale-aware                       |         |                                |                                                   |                                          |
| OST prefix         | `^(from                                                                        | uit                                                    | van de film)\s+"([^"]+)"\s*[-:]\s*`                       | `From "Top Gun" – Song`                                          | `{"kind":"ost","work":"<title>"}`                           | Yes (strip prefix)                                      |                                    |         |                                |                                                   |                                          |
| Karaoke/Tribute    | `[([-]\s*(karaoke version                                                      | tribute                                                | originally performed by .+)\s*[)]]?$`                     | `Song (Karaoke Version)`                                         | `{"kind":"karaoke"}` or `{"kind":"tribute"}`                | Yes                                                     | Guard against linking to originals |         |                                |                                                   |                                          |
| Medley             | `[\(\[-]\s*medley\s*[\)\]]?$`                                                  | `Song (Medley)`                                        | `{"kind":"medley"}`                                       | Yes                                                              |                                                             |                                                         |                                    |         |                                |                                                   |                                          |
| Single bundle      | `\b(A/?B                                                                       | double A-?side)\b                                      | .+\s*/\s*.+=?`                                            | `Song A / Song B`, `Double A-Side: A/B`                          | `{"kind":"single_bundle","sides":["a","b"]}`                | **No**                                                  | Populate `sides[]` if parseable    |         |                                |                                                   |                                          |
| Language version   | `[([-]\s*(english                                                              | dutch                                                  | german                                                    | spanish) version\s*[)]]?$`                                       | `Song (English Version)`                                    | `{"kind":"lang","value":"en                             | nl                                 | de      | es"}`                          | Mixed: keep core + tag                            | Keep language in core when it’s identity |
| Version labels     | `[([-]\s*(album version                                                        | single version                                         | lp version)\s*[)]]?$`                                     | `Song (Album Version)`                                           | `{"kind":"version","sub":"album                             | single                                                  | lp"}`                              | Yes     |                                |                                                   |                                          |
| Mix suffix generic | `[\(\[-]\s*mix\s*[\)\]]?$`                                                     | `Song (Mix)`                                           | `{"kind":"mix"}`                                          | Yes                                                              | Low info                                                    |                                                         |                                    |         |                                |                                                   |                                          |
| Remake/Cover cue   | `[([-]\s*(cover                                                                | tribute to .+)\s*[)]]?$`                               | `Song (Cover)`                                            | `{"kind":"cover"}`                                               | Yes                                                         | Still not the original work                             |                                    |         |                                |                                                   |                                          |
| Session/Peel       | `[([-]\s*(peel session                                                         | bbc session                                            | studio session)\s*[)]]?$`                                 | `Song (Peel Session)`                                            | `{"kind":"session","sub":"peel                              | bbc                                                     | studio"}`                          | Yes     |                                |                                                   |                                          |
| Mastering format   | `[([-]\s*(dolby atmos                                                          | 5.1                                                    | surround)\s*[)]]?$`                                       | `Song (Dolby Atmos)`                                             | `{"kind":"format","sub":"atmos                              | 5.1"}`                                                  | Yes                                |         |                                |                                                   |                                          |
| Remix pack parts   | `[([-]\s*(part                                                                 | pt.)\s*\d+\s*(remix(es)?)?\s*[)]]?$`                   | `Song (Pt. 2 Remix)`                                      | tags for part + remix                                            | Yes                                                         | Keep “Part n” in core if it’s identity (see guardrails) |                                    |         |                                |                                                   |                                          |

Guardrails already defined in the Normalization Ruleset govern “do not strip” for identity-bearing bits (e.g., `Part II`, classical catalog numbers, band **Live**).

# 2) Alias & Exceptions Seed (artists/titles) — NL/EN focus

**Purpose:** prevent over-normalization, preserve identity punctuation/articles, and provide canonical/alt forms for matching.

## 2.1 Artists — preserve articles/punctuation/diacritics

* Articles to **keep** (identity): `The The`, `The 1975`, `The Weeknd`, `The Band`
* Dutch articles to **keep**: `De Dijk`, `De Jeugd van Tegenwoordig`, `Het Goede Doel`, `DeWolff` (no space), `’t Hof van Commerce`
* Punctuation to **keep**: `P!nk`, `fun.`, `blink-182`, `!!!`, `(hed) p.e.`, `will.i.am`
* Diacritics to **keep** (store diacritics signature): `Tiësto`, `Björk`, `MØ`, `Zoë`, `Guus Méwis` (rare), `BLØF`, `Beyoncé`, `René Klijn`
* DJ prefixes (part of name): `DJ Paul Elstak`, `DJ Tiësto`, `DJ Jean`
* Name particles casing: `Armin van Buuren` (match “van” case-insensitive), `Nick van de Wall` (Afrojack)
* Multi-credit punctuation: treat `X & Y`, `X and Y`, `X x Y`, `X/X` as equivalent separators for matching

## 2.2 Titles — special cases

* Band **Live**: if artist is `Live`, don’t interpret `Live` in title as performance tag unless other signals present.
* Year variants to keep for display but strip for **core**: `’88`, `’98`, `(2020 Version)` (emit re_recording/version tags).
* Known OSTs that look like titles: phrases beginning `From "..."` are OST prefixes; strip to core, tag `ost`.

> This seed grows organically; store as an editable table `{name, preserve_article?, preserve_punct?, preserve_diacritics?, display_alias?, notes}`.

# 3) Side-Mapping Confidence (finalized constants)

* Evidence weights: `E1=0.40` (catalog side), `E2=0.25` (title match), `E3=0.20` (duration), `E4=0.10` (market notes), `E5=0.05` (retrospective DB note)
* Thresholds:

  * **Auto-link** if `conf ≥ 0.85`
  * **Review** if `0.60 ≤ conf < 0.85`
  * **Reject** if `< 0.60`
* Tie within `0.05` at/above auto threshold ⇒ treat as **double A-side** unless A/B explicitly indicated

# 4) Coverage Queries (final spec)

* `missing_from_chart(chart_id, period)` → rows: `{rank, title_raw, artist_raw, entry_unit, candidates[], reason}` where `reason ∈ {"no_link","low_confidence","bundle_unresolved"}`.
* `missing_in_library(chart_id[, period])` → rows: chart entries that link to a `work_key` you **don’t** own; sort by `score desc, highest asc`.
* `coverage_summary(chart_id)` → per period: `%linked`, `%present_in_library`, `top_gaps[10]` by score.

All three operate on local ETL DB, no live calls.

# 5) Evidence Bundle (field dictionary addendum)

You already have the schema; here’s a terse dictionary so fields are unambiguous:

* `artist.begin_area_country` — ISO-3166-1 alpha-2; from MB begin-area; nullable
* `recording.flags.is_live/is_remix/is_demo/is_radio_edit` — booleans inferred from normalization+MB relations
* `release_group.primary_type` — MB enum; `secondary_types[]` as MB strings
* `release.flags.is_official/is_promo/is_bootleg/is_reissue_hint/is_remaster_hint` — booleans from MB/Discogs heuristics
* `timeline_facts.*_date` — `YYYY[-MM[-DD]]` earliest known date per intent; `{source}` captures MB/Discogs/Both
* `provenance.sources_used` — subset of `{"MB","Discogs","Spotify","Wikidata"}`
* `config_snapshot.*` — values of your current knobs; stored to detect drift
* `evidence_hash` (derived) — SHA256 over canonical JSON without volatile fields

# 6) Determinism & Drift Controls (operational notes)

* Any change to **Normalization Ruleset**, **Edition Truth Table**, **Side-Mapping weights**, or **Canonicalization knobs** requires bumping a **ruleset version** recorded in Decision Trace (`cfg=…`) so you can explain future differences.
* Re-run modes: `--frozen` (never change past decisions), `--refresh` (recompute if evidence changed), `--review` (show drift).
